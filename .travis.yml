language: c

env:
  global:
   # The next declaration is the encrypted COVERITY_SCAN_TOKEN, created
   #   via the "travis encrypt" command using the project repo's public key
   - secure: "YBH+uswp+Q7XDssuEje/Ww/gF0jOHr7xIJ2vdbZT+voxrdFSEo/jIjkUMz0EseGZ7JRYCbo65Pqy1spSxS9j/x1ZZDhlOo4BOEW3n9UeoN1TAytqa4pj7ZXQdaVHX1zOR5cGu8zLmKlJayRd5jEqk3/qX1vcCpzWH6GpF3zmoCfQ2369TH8zn5hC7Fxx+3+H6wvsXQj73SuVvnSinkkZjWBRegca7w18oHgxeVsjmZ48Mke0bXDuN6mNcBnb3o3D1XxEnrSVgjfgH0gy/IWHSYZ1QjEaGPygpjWdagd7oqYbDUzK8IFdKb1f97ExnWzXiaCZzu8BgYO5S1bTnhCTU0fVZ4yLNEzjYUvhaStxS0Z5iwp30GpaahtyCdomxwt9mtl6Tx1tIc6qkAwHA6ZxqQAsaFaN6AbMot4BopkjGE5jCQvo52ak3G+1R1f2s/OSvBf7Uk23x9v1a/852wsz8NW3RFfHphWaiWtW6iW+TZO1WsL+v706vNa98uzQO1dfCateJ48LKgdvKyaucBCgOZZqsZUpHAZnuru2vEil3AzG3u19y78/AfVb1aiKPYOVJNkweSLdymRDOaIadOgZU6iMO0elUaNmGMHc9jUXVUmhhP+CKsuSUcF0LrlA0nxF1dvoVutWUMRUwrKm2HHCaJqMqSC3rkmiiphJdGxeLDQ="

addons:
  coverity_scan:
    # GitHub project metadata
    # ** specific to your project **
    project:
      name: "Parallel-NetCDF/PnetCDF"
      description: "PnetCDF nightly build submitted via Travis CI / Coverity Scan"
    build_command_prepend: ./configure --enable-profiling --enable-subfiling --enable-thread-safe --enable-burst_buffering --enable-shared --enable-debug --silent
    notification_email: wkliao@eecs.northwestern.edu
    build_command: make -s V=1 LIBTOOLFLAGS=--silent -j4 tests
    branch_pattern: test_travis_ci

before_install:
  - echo -n | openssl s_client -connect https://scan.coverity.com:443 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' | sudo tee -a /etc/ssl/certs/ca-

  - test -n $CC && unset CC
  # apt-package-whitelist can be found in
  # https://github.com/travis-ci/apt-package-whitelist/blob/master/ubuntu-precise
  - sudo add-apt-repository ppa:dns/gnu -y
  - sudo apt-get update -qq
  - sudo apt-get install -y gfortran
  - sudo apt-get install -y mpich2
  - sudo apt-get install -y netcdf-bin
  - sudo apt-get install -y libnetcdf-dev
  - which ncdump
  - which nc-config
  - nc-config --all
  - sudo apt-get install --only-upgrade autoconf
  - sudo apt-get install --only-upgrade automake
  - sudo apt-get install --only-upgrade libtool
  - autoconf --version
  - automake --version
  - libtool --version
  - autoreconf -i
  # - ./configure --enable-netcdf4
  # - make -s tests

after_success:
  - make -s distclean

after_failure:
  - cat ./config.log
  - make -s distclean
  # - cat /home/travis/build/wkliao/pnetcdf/cov-int/build-log.txt

notifications:
  email: false

branches:
    only:
        - test_travis_ci
